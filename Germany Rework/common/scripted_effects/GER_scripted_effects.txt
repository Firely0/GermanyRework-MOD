give_SOV_armor_research_bonuses = {
	#this effect is run for the Soviets!
	if = {
		limit = {
			NOT = {
				has_dlc = "No Step Back"
			}
		}
		add_tech_bonus = {
			name = med_armor_bonus
			ahead_reduction = 2
			category = cat_medium_armor
		}
		add_tech_bonus = {
			name = armor_bonus
			bonus = 1
			uses = 1
			category = armor
		}
	}
	if = {
		#double if because history files don't like else and this effect is run in the Soviet history file
		limit = {
			has_dlc = "No Step Back"
		}
		create_equipment_variant = {
			name = "A-20"
			type = medium_tank_chassis_1
			parent_version = 0
			modules = {
				main_armament_slot = tank_small_cannon_2
				turret_type_slot = tank_medium_two_man_tank_turret
				suspension_type_slot = tank_christie_suspension
				armor_type_slot = tank_welded_armor
				engine_type_slot = tank_diesel_engine
				special_type_slot_1 = sloped_armor
			}
			upgrades = {
				tank_nsb_engine_upgrade = 8
				tank_nsb_armor_upgrade = 2
			}
			icon = "GFX_SOV_basic_medium_tank_medium"
		}
		create_equipment_variant = {
			name = "KV-1"
			type = heavy_tank_chassis_1
			parent_version = 0
			modules = {
				main_armament_slot = tank_medium_cannon
				turret_type_slot = tank_heavy_three_man_tank_turret
				suspension_type_slot = tank_torsion_bar_suspension
				armor_type_slot = tank_welded_armor
				engine_type_slot = tank_diesel_engine
			}
			upgrades = {
				tank_nsb_engine_upgrade = 10
				tank_nsb_armor_upgrade = 9
			}
			icon = "GFX_SOV_improved_heavy_tank_medium"
		}
		add_tech_bonus = {
			name = armor_bonus
			bonus = 1
			uses = 2
			category = armor
		}
	}
}

MR_pact_transfer_state_effect = {
	if = {
		limit = {
			96 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 96
						is_subject_of = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					any_other_country = {
						is_in_faction_with = SOU
						has_country_flag = BLT_soviets_said_yes_to_belarus_flag
					}
				}
			}
			SOU = {
				transfer_state = 96
			}
		}
		else = {
			random_other_country = {
				limit = {
					is_in_faction_with = SOU
					OR = {
						has_cosmetic_tag = LIT_belarus
						has_cosmetic_tag = LAT_belarus
						has_cosmetic_tag = EST_belarus
						has_cosmetic_tag = BAL_UNIFIED
					}
				}
				transfer_state = 96
			}
		}
	}
	if = {
		limit = {
			95 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 95
						is_subject_of = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					any_other_country = {
						is_in_faction_with = SOU
						has_country_flag = BLT_soviets_said_yes_to_belarus_flag
					}
				}
			}
			SOU = {
				transfer_state = 95
			}
		}
		else = {
			random_other_country = {
				limit = {
					is_in_faction_with = SOU
					OR = {
						has_cosmetic_tag = LIT_belarus
						has_cosmetic_tag = LAT_belarus
						has_cosmetic_tag = EST_belarus
						has_cosmetic_tag = BAL_UNIFIED
					}
				}
				transfer_state = 95
			}
		}
	}
	if = {
		limit = {
			94 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 94
						is_subject_of = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					any_other_country = {
						is_in_faction_with = SOU
						has_country_flag = BLT_soviets_said_yes_to_belarus_flag
					}
				}
			}
			SOU = {
				transfer_state = 94
			}
		}
		else = {
			random_other_country = {
				limit = {
					is_in_faction_with = SOU
					OR = {
						has_cosmetic_tag = LIT_belarus
						has_cosmetic_tag = LAT_belarus
						has_cosmetic_tag = EST_belarus
						has_cosmetic_tag = BAL_UNIFIED
					}
				}
				transfer_state = 94
			}
		}
	}
	if = {
		limit = {
			93 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 93
						is_subject_of = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 93
		}
	}
	if = {
		limit = {
			91 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 91
						is_subject_of = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 91
		}
	}
	if = {
		limit = {
			97 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 97
						is_subject_of = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					any_other_country = {
						is_in_faction_with = SOU
						has_country_flag = BLT_soviets_said_yes_to_belarus_flag
					}
				}
			}
			SOU = {
				transfer_state = 97
			}
		}
		else = {
			random_other_country = {
				limit = {
					is_in_faction_with = SOU
					OR = {
						has_cosmetic_tag = LIT_belarus
						has_cosmetic_tag = LAT_belarus
						has_cosmetic_tag = EST_belarus
						has_cosmetic_tag = BAL_UNIFIED
					}
				}
				transfer_state = 97
				97 = {
					add_core_of = PREV
				}
			}
		}
	}
	if = {
		limit = {
			89 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 89
						is_subject_of = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 89
		}
	}
	if = {
		limit = {
			784 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 784
						is_subject_of = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_global_flag = LIT_gets_vilnius
					LIT = {
						controls_state = 784
					}
					LIT = {
						is_in_faction_with = SOU
					}
				}
				LIT = {
					exists = yes
				}
			}
			LIT = {
				transfer_state = 784
			}
		}
		else_if = {
			limit = {
				NOT = {
					any_other_country = {
						is_in_faction_with = SOU
						has_country_flag = BLT_soviets_said_yes_to_belarus_flag
					}
				}
			}
			SOU = {
				transfer_state = 784
			}
		}
		else = {
			random_other_country = {
				limit = {
					is_in_faction_with = SOU
					OR = {
						has_cosmetic_tag = LIT_belarus
						has_cosmetic_tag = LAT_belarus
						has_cosmetic_tag = EST_belarus
						has_cosmetic_tag = BAL_UNIFIED
					}
				}
				transfer_state = 784
			}
		}
	}
}

MR_pact_transfer_faction_state_effect = {
	if = {
		limit = {
			96 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 96
						is_in_faction_with = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 96
		}
	}
	if = {
		limit = {
			95 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 95
						is_in_faction_with = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 95
		}
	}
	if = {
		limit = {
			94 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 94
						is_in_faction_with = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 94
		}
	}
	if = {
		limit = {
			93 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 93
						is_in_faction_with = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 93
		}
	}
	if = {
		limit = {
			91 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 91
						is_in_faction_with = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 91
		}
	}
	if = {
		limit = {
			97 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 97
						is_in_faction_with = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 97
		}
	}
	if = {
		limit = {
			89 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 89
						is_in_faction_with = ROOT
					}
				}
			}
		}
		SOU = {
			transfer_state = 89
		}
	}
	if = {
		limit = {
			784 = {
				OR = {
					is_controlled_by = ROOT
					any_other_country = {
						controls_state = 784
						is_in_faction_with = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				OR = {
					has_global_flag = LIT_gets_vilnius
					LIT = {
						controls_state = 784
					}
				}
				LIT = {
					exists = yes
				}
			}
			LIT = {
				transfer_state = 784
			}
		}
		else = {
			SOU = {
				transfer_state = 784
			}
		}
	}
}

GER_upgrade_wehrmacht_effect = {
	hidden_effect = {
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Wehrmacht_dynamic_modifier
				}
				has_completed_focus = GER_tank_warfare
			}
			remove_dynamic_modifier = {
				modifier = Wehrmacht_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Wehrmacht_Tank_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Wehrmacht_Main_inf
				add_idea = Wehrmacht_Main_Tank
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Wehrmacht_Tank_dynamic_modifier
				}
				has_completed_focus = GER_tank_warfare
			}
			remove_dynamic_modifier = {
				modifier = Wehrmacht_Tank_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Wehrmacht_Tank_1_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Wehrmacht_Main_Tank
				add_idea = Wehrmacht_Main_Tank_1
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Wehrmacht_Tank_1_dynamic_modifier
				}
				has_completed_focus = GER_tank_warfare
			}
			remove_dynamic_modifier = {
				modifier = Wehrmacht_Tank_1_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Wehrmacht_Tank_2_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Wehrmacht_Main_Tank_1
				add_idea = Wehrmacht_Main_Tank_2
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Wehrmacht_dynamic_modifier
				}
				has_completed_focus = GER_Battle_Plan
			}
			remove_dynamic_modifier = {
				modifier = Wehrmacht_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Wehrmacht_INF_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Wehrmacht_INF_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Wehrmacht_INF_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Wehrmacht_INF_1_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Wehrmacht_INF_1_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Wehrmacht_INF_1_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Wehrmacht_INF_2_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Wehrmacht_Main_inf
				add_idea = Wehrmacht_Main_inf_1
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Wehrmacht_INF_2_dynamic_modifier
				}
				has_completed_focus = GER_Cheap_EQ
			}
			remove_dynamic_modifier = {
				modifier = Wehrmacht_INF_2_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Wehrmacht_INF_3_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Wehrmacht_Main_inf_1
				add_idea = WehrmachtWarPlana_h
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Wehrmacht_INF_3_dynamic_modifier
				}
				has_completed_focus = GER_Cheap_SUP
			}
			remove_dynamic_modifier = {
				modifier = Wehrmacht_INF_3_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Wehrmacht_INF_4_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = WehrmachtWarPlana_h
				add_idea = WehrmachtWarPlanb_h
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = SS_forces_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = SS_forces_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = SS_forces_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = SS_forces_dynamic_modifier
				}
				has_completed_focus = GER_SS_Search_and_Destroy
			}
			remove_dynamic_modifier = {
				modifier = SS_forces_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = SS_forces_1_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_SD_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_SD_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_SD_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_SD_A_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_SD_A_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_SD_A_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_SD_B_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_SD_B_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_SD_B_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_CAS_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_CAS_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_CAS_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_CAS_A_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_CAS_A_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_CAS_A_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_OI_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_OI_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_OI_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_OI_A_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_OI_A_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_OI_A_dynamic_modifier
			}
		}
		# Navy
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_Carrier_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_Carrier_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_Carrier_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_CarrierGloryofmodernger_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_CarrierGloryofmodernger_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_CarrierGloryofmodernger_dynamic_modifier
			}
		}
	}
}

GER_upgrade_luftwaffe_effect = {
	hidden_effect = {
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_dynamic_modifier
				}
				has_completed_focus = GER_Strategic_Des
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_SD_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Luftwaffe_debuff
				add_idea = Luftwaffe_SD
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_SD_dynamic_modifier
				}
				has_completed_focus = GER_Improve_Des
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_SD_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_SD_A_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_SD_A_dynamic_modifier
				}
				has_completed_focus = GER_Mixed_Bombing
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_SD_A_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_SD_B_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_dynamic_modifier
				}
				has_completed_focus = GER_CAS
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_CAS_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Luftwaffe_debuff
				add_idea = Luftwaffe_CAS
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_CAS_dynamic_modifier
				}
				has_completed_focus = GER_Improve_CAS
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_CAS_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_CAS_A_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Luftwaffe_CAS
				add_idea = Luftwaffe_CAS_R
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_dynamic_modifier
				}
				has_completed_focus = GER_Operational_Integratiy
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_OI_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Luftwaffe_debuff
				add_idea = Luftwaffe_OI
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Luftwaffe_OI_dynamic_modifier
				}
				has_completed_focus = GER_Improve_TAC
			}
			remove_dynamic_modifier = {
				modifier = Luftwaffe_OI_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Luftwaffe_OI_A_dynamic_modifier
			}
			swap_ideas = {
				remove_idea = Luftwaffe_OI
				add_idea = Luftwaffe_OI_IMP
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_Carrier_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_Carrier_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_Carrier_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
			}
		}
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_CarrierGloryofmodernger_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_CarrierGloryofmodernger_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_CarrierGloryofmodernger_dynamic_modifier
			}
		}
	}
}

GER_upgrade_kriegsmarine_effect = {
	hidden_effect = {
		if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_dynamic_modifier
				}
				has_completed_focus = GER_carrier_war
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_Carrier_dynamic_modifier
			}
		}
		else_if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_dynamic_modifier
				}
				has_completed_focus = GER_modular_construction_a
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
			}
		}
		else_if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_Gloryofmodernger_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_CarrierGloryofmodernger_dynamic_modifier
			}
		}
		else_if = {
			limit = {
				has_dynamic_modifier = {
					modifier = Kriegsmarine_Carrier_dynamic_modifier
				}
			}
			remove_dynamic_modifier = {
				modifier = Kriegsmarine_Carrier_dynamic_modifier
			}
			add_dynamic_modifier = {
				modifier = Kriegsmarine_CarrierGloryofmodernger_dynamic_modifier
			}
		}
	}
}

GER_upgrade_kriegsmarine_idea_effect = {
	if = {
		limit = {
			has_idea = Kriegsmarine_Debuff_Version
			has_completed_focus = GER_modular_construction_a
		}
		swap_ideas = {
			remove_idea = Kriegsmarine_Debuff_Version
			add_idea = Kriegsmarine_buff_Version_No_Carrier
		}
	}
	if = {
		limit = {
			has_idea = Kriegsmarine_Debuff_Version
			has_completed_focus = GER_carrier_war
		}
		swap_ideas = {
			remove_idea = Kriegsmarine_Debuff_Version
			add_idea = Kriegsmarine_Debuff_Version_Carrier
		}
	}
	if = {
		limit = {
			has_idea = Kriegsmarine_buff_Version_No_Carrier
			has_completed_focus = GER_carrier_war
		}
		swap_ideas = {
			remove_idea = Kriegsmarine_buff_Version_No_Carrier
			add_idea = Kriegsmarine_Debuff_Version_Last_Version
		}
	}
	if = {
		limit = {
			has_idea = Kriegsmarine_Debuff_Version_Carrier
			has_completed_focus = GER_modular_construction_a
		}
		swap_ideas = {
			remove_idea = Kriegsmarine_Debuff_Version_Carrier
			add_idea = Kriegsmarine_Debuff_Version_Last_Version
		}
	}
}

GER_Lands_in_Soviet = {
	every_state = {
		limit = {
			AND = {
				is_owned_by = SOV
				has_state_flag = GER_Claim_lands
			}
		}
		transfer_state_to = GER
	}
	every_state = {
		limit = {
			NOT = {
				AND = {
					is_owned_by = SOV
					is_controlled_by_GER_or_subject = no
					has_state_flag = GER_Claim_lands
				}
			}
		}
		add_claim_by = GER
		clr_state_flag = GER_Claim_lands
	}
	every_country = {
		limit = {
			has_country_flag = GER_SOV_PUPPET_COUNTRY
			has_capitulated = yes
		}
		every_owned_state = {
			transfer_state_to = GER
		}
		clr_country_flag = GER_SOV_PUPPET_COUNTRY
	}
}

JAP_Lands_in_Soviet = {
	if = {
		limit = {
			408 = {
				OR = {
					OR = {
						is_owned_by = SOV
						is_owned_by = GER
					}
					is_owned_by = GER
				}
			}
			409 = {
				OR = {
					OR = {
						is_owned_by = SOV
						is_owned_by = GER
					}
					is_owned_by = GER
				}
			}
			655 = {
				OR = {
					OR = {
						is_owned_by = SOV
						is_owned_by = GER
					}
					is_owned_by = GER
				}
			}
		}
		JAP = {
			transfer_state = 408
			transfer_state = 409
			transfer_state = 655
			add_state_core = 655
		}
		JAP = {
			add_opinion_modifier = {
				target = GER
				modifier = GER_Fate_of_SOV
			}
		}
	}
}

ROM_Lands_in_Soviet = {
	if = {
		limit = {
			80 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
				}
			}
			78 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
				}
			}
			766 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
				}
			}
		}
		ROM = {
			transfer_state = 80
			transfer_state = 78
			transfer_state = 766
		}
		ROM = {
			add_opinion_modifier = {
				target = GER
				modifier = GER_Fate_of_SOV
			}
		}
	}
}

FIN_Lands_in_Soviet = {
	if = {
		limit = {
			146 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
					is_owned_by = FIN
				}
			}
			147 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
					is_owned_by = FIN
				}
			}
			722 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
					is_owned_by = FIN
				}
			}
		}
		FIN = {
			transfer_state = 146
			transfer_state = 147
			transfer_state = 722
		}
		FIN = {
			add_opinion_modifier = {
				target = GER
				modifier = GER_Fate_of_SOV
			}
		}
	}
}

TUR_Lands_in_Soviet = {
	if = {
		limit = {
			231 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
				}
			}
			229 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
				}
			}
			230 = {
				OR = {
					is_owned_by = SOV
					is_owned_by = GER
				}
			}
		}
		TUR = {
			transfer_state = 231
			transfer_state = 229
			transfer_state = 230
			add_state_core = 229
		}
		TUR = {
			add_opinion_modifier = {
				target = GER
				modifier = GER_Fate_of_SOV
			}
		}
	}
}

GER_isolate_effect = {
	GER = {
		every_neighbor_country = {
			limit = {
				NOT = {
					tag = GER
					tag = FRA
				}
			}
			country_event = {
				id = GER_rhineland_isolete.1
			}
		}
	}
}

GER_Vichy_state_modifier = {
	every_state = {
		limit = {
			OR = {
				state = 18
				state = 29
				state = 785
				state = 16
				state = 15
				state = 30
				state = 24
				state = 14
				state = 30
				state = 23
				state = 19
				state = 806
				state = 27
				state = 17
			}
		}
		add_dynamic_modifier = {
			modifier = Ger_non_vichy_state_dynamic_modifier
			scope = GER
		}
	}
	set_global_flag = ITA_GER_VICHY_ESTABLISHED
}

GER_Vichy_state_modifier_remove = {
	every_state = {
		limit = {
			OR = {
				state = 18
				state = 29
				state = 785
				state = 16
				state = 15
				state = 30
				state = 24
				state = 14
				state = 30
				state = 23
				state = 19
				state = 806
				state = 27
				state = 17
			}
		}
		remove_dynamic_modifier = {
			modifier = Ger_non_vichy_state_dynamic_modifier
		}
	}
}

GER_SOV_white_peace_check = {
	every_state = {
		limit = {
			OR = {
				has_state_flag = mr_pact_sov_reserved_state_unnegotiable
				has_state_flag = mr_pact_sov_reserved_state_special
				has_state_flag = mr_pact_sov_reserved_state
			}
			OR = {
				is_controlled_by = GER
				is_controlled_by = SOV
			}
		}
		transfer_state_to = SOV
	}
	every_state = {
		limit = {
			OR = {
				has_state_flag = mr_pact_sov_reserved_state_unnegotiable
				has_state_flag = mr_pact_sov_reserved_state_special
				has_state_flag = mr_pact_sov_reserved_state
			}
			is_controlled_by = SOV			# We Have it Remove Icon/s
		}
		remove_dynamic_modifier = {
			modifier = Soviet_state_dynamic_modifier
		}
	}
	if = {
		limit = {
			POL = {
				has_capitulated = yes
				has_war_with = SOV				#Cap but Keep Fighting with SOV.
			}
		}
		SOV = {
			white_peace = POL
		}
	}
	every_state = {
		limit = {
			OR = {
				has_state_flag = mr_pact_ger_reserved_state_special
				has_state_flag = mr_pact_ger_reserved_state
			}
			is_controlled_by = SOV
		}
		set_state_controller_to = GER
	}
	every_state = {
		limit = {
			OR = {
				has_state_flag = mr_pact_ger_reserved_state_special
				has_state_flag = mr_pact_ger_reserved_state
			}
			is_owned_by = SOV
		}
		set_state_owner_to = GER
	}
	every_state = {
		limit = {
			OR = {
				has_state_flag = mr_pact_ger_reserved_state_special
				has_state_flag = mr_pact_ger_reserved_state
			}
			is_controlled_by = GER			# We Have it Remove Icon/s
		}
		remove_dynamic_modifier = {
			modifier = Germany_state_dynamic_modifier
		}
	}
	every_state = {
		limit = {
			OR = {
				has_dynamic_modifier = {
					modifier = Soviet_state_dynamic_modifier
				}
				has_dynamic_modifier = {
					modifier = Germany_state_dynamic_modifier
				}
			}
		}
		remove_dynamic_modifier = {
			modifier = Soviet_state_dynamic_modifier
		}
		remove_dynamic_modifier = {
			modifier = Germany_state_dynamic_modifier
		}
	}
	clr_global_flag = GER_SOV_WHITE_PEACE_1
	set_global_flag = GER_SOV_END_OF_PACT_EVENT
}

GER_mr_pact_next_event = {
	if = {
		limit = {
			country_exists = FIN
			NOT = {
				FIN = {
					has_country_flag = mr_pact_sent_event
				}
			}
		}
		FIN = {
			set_country_flag = mr_pact_sent_event
		}
		GER = {
			country_event = mrpact_negociations_finland.1
		}
	}
	else_if = {
		limit = {
			country_exists = EST
			NOT = {
				EST = {
					has_country_flag = mr_pact_sent_event
				}
			}
		}
		EST = {
			set_country_flag = mr_pact_sent_event
		}
		GER = {
			country_event = {
				id = mrpact_negociations_estonia.1
				hours = 5
			}
		}
	}
	else_if = {
		limit = {
			country_exists = LAT
			NOT = {
				LAT = {
					has_country_flag = mr_pact_sent_event
				}
			}
		}
		LAT = {
			set_country_flag = mr_pact_sent_event
		}
		GER = {
			country_event = {
				id = mrpact_negociations_latvia.1
				hours = 5
			}
		}
	}
	else_if = {
		limit = {
			country_exists = LIT
			NOT = {
				LIT = {
					has_country_flag = mr_pact_sent_event
				}
			}
		}
		LIT = {
			set_country_flag = mr_pact_sent_event
		}
		GER = {
			country_event = {
				id = mrpact_negociations_lithuania.1
				hours = 5
			}
		}
	}
	else_if = {
		limit = {
			country_exists = POL
			NOT = {
				POL = {
					has_country_flag = mr_pact_sent_event
				}
			}
		}
		POL = {
			set_country_flag = mr_pact_sent_event
		}
		GER = {
			country_event = {
				id = mrpact_negociations_poland.1
				hours = 5
			}
		}
	}
	else_if = {
		limit = {
			OR = {
				FIN = {
					has_country_flag = mr_pact_sent_event
					exists = no
				}
			}
			OR = {
				LAT = {
					has_country_flag = mr_pact_sent_event
					exists = no
				}
			}
			OR = {
				LIT = {
					has_country_flag = mr_pact_sent_event
					exists = no
				}
			}
			OR = {
				EST = {
					has_country_flag = mr_pact_sent_event
					exists = no
				}
			}
			OR = {
				POL = {
					has_country_flag = mr_pact_sent_event
					exists = no
				}
			}
		}
		SOV = {
			country_event = {
				id = mrpact_final.1
				hours = 5
			}
		}
	}
}

GER_AUS_annex = {
	4 = {
		if = {
			limit = {
				is_owned_by = AUS
			}
			add_core_of = GER
		}
	}
	152 = {
		if = {
			limit = {
				is_owned_by = AUS
			}
			add_core_of = GER
		}
	}
	153 = {
		if = {
			limit = {
				is_owned_by = AUS
			}
			add_core_of = GER
		}
	}
	848 = {
		if = {
			limit = {
				is_owned_by = AUS
			}
			add_core_of = GER
		}
	}
	AUS = {
		every_unit_leader = {
			set_nationality = GER
		}
	}
	annex_country = {
		target = AUS
		transfer_troops = yes
	}
	add_political_power = 75
	set_country_flag = AUS_annexed
	add_war_support = 0.1
	add_stability = 0.05
	army_experience = 10
}

GER_AI_EQ_1 = {
	if = {
		limit = {
			is_ai = yes
		}
		add_equipment_to_stockpile = {
			type = infantry_equipment
			amount = 10000
			producer = GER
		}
		add_equipment_to_stockpile = {
			type = support_equipment
			amount = 500
			producer = GER
		}
	}
}

GER_AI_DIV = {
	if = {
		limit = {
			is_ai = yes
		}
		division_template = {
			name = "Panzer Division"
			is_locked = no
			priority = 0
			regiments = {
				medium_armor = {
					x = 0
					y = 0
				}
				medium_armor = {
					x = 0
					y = 1
				}
				medium_armor = {
					x = 0
					y = 2
				}
				medium_armor = {
					x = 0
					y = 3
				}
				medium_armor = {
					x = 0
					y = 4
				}
				medium_armor = {
					x = 1
					y = 0
				}
				medium_armor = {
					x = 1
					y = 1
				}
				medium_armor = {
					x = 1
					y = 2
				}
				medium_armor = {
					x = 1
					y = 3
				}
				medium_armor = {
					x = 1
					y = 4
				}
				medium_armor = {
					x = 2
					y = 0
				}
				medium_armor = {
					x = 2
					y = 1
				}
				medium_armor = {
					x = 2
					y = 2
				}
				medium_armor = {
					x = 2
					y = 3
				}
				medium_tank_destroyer_brigade = {
					x = 2
					y = 4
				}
				mechanized = {
					x = 3
					y = 0
				}
				mechanized = {
					x = 3
					y = 1
				}
				mechanized = {
					x = 3
					y = 2
				}
				mechanized = {
					x = 3
					y = 3
				}
				mechanized = {
					x = 3
					y = 4
				}
			}
			support = {
				medium_flame_tank = {
					x = 0
					y = 0
				}
				armored_car_recon = {
					x = 0
					y = 1
				}
				logistics_company = {
					x = 0
					y = 2
				}
				signal_company = {
					x = 0
					y = 3
				}
				engineer = {
					x = 0
					y = 4
				}
			}
		}
		set_technology = {
			tech_engineers2 = 1
			popup = no
		}
		set_technology = {
			tech_signal_company = 1
			popup = no
		}
		set_technology = {
			mechanised_infantry = 1
			popup = no
		}
		create_equipment_variant = {
			name = "Flammpanzer III Ausf. M"
			type = medium_tank_flame_chassis_2
			parent_version = 0
			allow_without_tech = yes
			modules = {
				main_armament_slot = flamethrower
				turret_type_slot = tank_medium_two_man_tank_turret
				suspension_type_slot = tank_torsion_bar_suspension
				armor_type_slot = tank_welded_armor
				engine_type_slot = tank_gasoline_engine
			}
			upgrades = {
				tank_nsb_engine_upgrade = 9
				tank_nsb_armor_upgrade = 11
			}
			icon = "GFX_GER_medium_BAB"
			model = "GER_medium_armor_0_entity"
		}
		create_railway_gun = {
			equipment = railway_gun_equipment_1
			name = TAG_new_railway_gun
			location = 6521
		}
		64 = {
			create_unit = {
				division = "name = \"Panzer Division\" division_template = \"Panzer Division\" start_experience_factor = 1.0"
				owner = GER
			}
			create_unit = {
				division = "name = \"Panzer Division 2\" division_template = \"Panzer Division\" start_experience_factor = 1.0"
				owner = GER
			}
		}
	}
}

GER_Give_fascism_effect = {
	load_focus_tree = {
		tree = german_better
		keep_completed = yes
	}
	set_variable = {
		adolf_hitler_rest = 1
	}
	set_variable = {
		adolf_hitler_rest_bad = 1
	}
	set_variable = {
		theodor_morell = 1
	}
	set_variable = {
		best_doctors = 1
	}
	set_variable = {
		Adolf_Health_Year_TIME = 365
	}
	add_opinion_modifier = {
		target = SWE
		modifier = oldtradeparterns
	}
	SWE = {
		add_opinion_modifier = {
			target = ROOT
			modifier = oldtradeparterns
		}
	}
	add_opinion_modifier = {
		target = SWE
		modifier = oldtradeparterns
	}
	SWE = {
		add_opinion_modifier = {
			target = ROOT
			modifier = oldtradeparterns
		}
	}
	set_country_flag = GER_BLOCKED_TOTAL_WAR
	uncomplete_national_focus = {
		focus = GER_against_fuhrer
		uncomplete_children = yes
		refund_political_power = no
	}
	complete_national_focus = GER_establish_abwehr
	drop_cosmetic_tag = yes
	set_cosmetic_tag = GER_the_third_reich
	save_event_target_as = fascist_germany_civil_war
	every_unit_leader = {
		set_nationality = GER
	}
	set_variable = {
		GER_max_command_power = -20
	}
	set_variable = {
		GER_max_planning_factor = -0.2
	}
	set_variable = {
		GER_planning_speed = -0.1
	}
	set_variable = {
		GER_minimum_training_level = 0.1
	}
	set_variable = {
		GER_land_doctrine_cost_factor = 0.1
	}
	set_variable = {
		GER_air_mission_efficiency = -0.1
	}
	set_variable = {
		GER_air_accidents_factor = 0.1
	}
	set_variable = {
		GER_air_doctrine_cost_factor = 0.1
	}
	set_variable = {
		GER_navy_visibility = 0.1
	}
	set_variable = {
		GER_sub_retreat_speed = 0.05
	}
	set_variable = {
		GER_critical_receive_chance = 0.1
	}
	set_variable = {
		GER_naval_doctrine_cost_factor = 0.1
	}
	add_dynamic_modifier = {
		modifier = Wehrmacht_dynamic_modifier
	}
	add_dynamic_modifier = {
		modifier = Luftwaffe_dynamic_modifier
	}
	add_dynamic_modifier = {
		modifier = Kriegsmarine_dynamic_modifier
	}
	GER = {
		every_unit_leader = {
			limit = {
				OR = {
					has_id = 10
					has_id = 15
					has_id = 20
					has_id = 24
					has_trait = trait_GER_SS
				}
			}
			set_nationality = event_target:fascist_germany_civil_war
		}
	}
}

GER_last_tiger_ace_effect = {
	division_template = {
		name = "SS Heavy Panzer Battalion"
		is_locked = yes
		priority = 0
		regiments = {
			heavy_armor = {
				x = 0
				y = 0
			}
			heavy_armor = {
				x = 0
				y = 1
			}
			heavy_armor = {
				x = 0
				y = 2
			}
			heavy_armor = {
				x = 0
				y = 3
			}
			heavy_armor = {
				x = 0
				y = 4
			}
			heavy_armor = {
				x = 1
				y = 0
			}
			heavy_armor = {
				x = 1
				y = 1
			}
			heavy_armor = {
				x = 1
				y = 2
			}
			heavy_armor = {
				x = 1
				y = 3
			}
			heavy_armor = {
				x = 1
				y = 4
			}
			heavy_armor = {
				x = 2
				y = 0
			}
			heavy_armor = {
				x = 2
				y = 1
			}
			heavy_armor = {
				x = 2
				y = 2
			}
			heavy_armor = {
				x = 2
				y = 3
			}
			heavy_armor = {
				x = 2
				y = 4
			}
			mechanized = {
				x = 3
				y = 0
			}
			mechanized = {
				x = 3
				y = 1
			}
			mechanized = {
				x = 3
				y = 2
			}
			mechanized = {
				x = 3
				y = 3
			}
			mechanized = {
				x = 3
				y = 4
			}
			heavy_armor = {
				x = 4
				y = 0
			}
			heavy_armor = {
				x = 4
				y = 1
			}
		}
		support = {
			armored_car_recon = {
				x = 0
				y = 0
			}
			logistics_company = {
				x = 0
				y = 1
			}
			signal_company = {
				x = 0
				y = 2
			}
			engineer = {
				x = 0
				y = 3
			}
		}
	}
	64 = {
		create_unit = {
			division = "name = \"101st SS Heavy Panzer Division\" division_template = \"SS Heavy Panzer Battalion\" start_experience_factor = 1.0 start_equipment_factor = 1.0 start_manpower_factor = 1.0"
			owner = GER
		}
	}
	random_country_division = {
		limit = {
			OR = {
				division_has_battalion_in_template = heavy_armor
			}
			division_has_battalion_in_template = mechanized
			is_unit_template_reserves = no
			unit_strength > 0.5
		}
		add_history_entry = {
			key = "This unit has been recognised as an Elite panzer division."
			subject = "Division Honor"
			allow = yes
		}
		add_unit_medal_to_latest_entry = {
			unit_medals = knights_cross_oak_leaves
		}
	}
}

GER_upgrade_france_comp = {
	if = {
		limit = {
			has_idea = renault_ger
		}
		swap_ideas = {
			remove_idea = renault_ger
			add_idea = renault_ger_a
		}
	}
	if = {
		limit = {
			has_idea = GER_AMX
		}
		swap_ideas = {
			remove_idea = GER_AMX
			add_idea = GER_AMX_a
		}
	}
	if = {
		limit = {
			has_idea = GER_APX
		}
		swap_ideas = {
			remove_idea = GER_APX
			add_idea = GER_APX_a
		}
	}
	if = {
		limit = {
			has_idea = GER_panhard
		}
		swap_ideas = {
			remove_idea = GER_panhard
			add_idea = GER_panhard_a
		}
	}
	if = {
		limit = {
			has_idea = GER_aeb
		}
		swap_ideas = {
			remove_idea = GER_aeb
			add_idea = GER_aeb_a
		}
	}
	if = {
		limit = {
			has_idea = GER_acl
		}
		swap_ideas = {
			remove_idea = GER_acl
			add_idea = GER_acl_a
		}
	}
	if = {
		limit = {
			has_idea = GER_acf
		}
		swap_ideas = {
			remove_idea = GER_acf
			add_idea = GER_acf_a
		}
	}
	if = {
		limit = {
			has_idea = GER_morane_saulnier
		}
		swap_ideas = {
			remove_idea = GER_morane_saulnier
			add_idea = GER_morane_saulnier_a
		}
	}
	if = {
		limit = {
			has_idea = GER_amiot
		}
		swap_ideas = {
			remove_idea = GER_amiot
			add_idea = GER_amiot_a
		}
	}
	if = {
		limit = {
			has_idea = GER_levasseur
		}
		swap_ideas = {
			remove_idea = GER_levasseur
			add_idea = GER_levasseur_a
		}
	}
}

rudolf_hess_africa_front_GER = {
	every_state = {
		limit = {
			OR = {
				state = 777
				state = 773
				state = 774
				state = 660
				state = 539
				state = 772
				state = 295
				state = 538
				state = 718
				state = 885
				state = 548
				state = 890
				state = 768
				state = 769
				state = 564
				state = 770
				state = 771
				state = 889
				state = 888
				state = 545
				state = 542
				state = 546
			}
		}
		set_state_flag = GER_Africa_states
	}
	every_state = {
		limit = {
			has_state_flag = GER_Africa_states
		}
		transfer_state_to = GER
	}
}

rudolf_hess_africa_front_ITA = {
	every_state = {
		limit = {
			OR = {
				state = 905
				state = 457
				state = 904
				state = 903
				state = 844
				state = 559
				state = 269
				state = 268
				state = 550
				state = 884
				state = 886
				state = 883
				state = 887
				state = 549
				state = 551
				state = 456
				state = 457
				state = 907
				state = 447
				state = 907
				state = 447
				state = 453
				state = 454
				state = 455
				state = 553
				state = 554
				state = 782
				state = 677
				state = 680
				state = 452
				state = 552
				state = 273
				state = 514
				state = 786
				state = 515
				state = 775
				state = 767
				state = 547
				state = 462
				state = 461
				state = 513
				state = 459
				state = 458
				state = 665
				state = 460
			}
		}
		set_state_flag = ITA_Africa_states
	}
	every_state = {
		limit = {
			has_state_flag = ITA_Africa_states
		}
		transfer_state_to = ITA
	}
}

rudolf_hess_africa_front_International_Zone = {
	ENG = {
		446 = {
			transfer_state_to = GER
		}
	}
	ROOT = {
		release_on_controlled = EGY
	}
	every_country = {
		limit = {
			NOT = {
				tag = EGY
			}
			is_major = yes
		}
		give_guarantee = EGY
		add_ai_strategy = {
			type = protect
			id = "EGY"
			value = 50
		}
	}
	every_country = {
		limit = {
			OR = {
				tag = GER
				tag = ITA
				tag = ENG
				tag = USA
			}
		}
		diplomatic_relation = {
			country = PREV
			relation = military_access
			active = no
		}
	}
}

rudolf_hess_italy_annex_eth_w_puppets = {
	ITA = {
		if = {
			limit = {
				any_country = {
					is_puppet_of = ETH
				}
			}
			ITA = {
				annex_country = {
					target = PREV
					transfer_troops = no
				}
			}
		}
		annex_country = {
			target = ETH
			transfer_troops = no
		}
	}
}

rudolf_hess_GER_states = {
	every_state = {
		limit = {
			OR = {
				state = 28
			}
		}
		transfer_state_to = GER
	}
}

rudolf_hess_GER_POL_states = {
	GER = {
		release_on_controlled = POL
		puppet = POL
	}
	every_state = {
		limit = {
			OR = {
				state = 86
				state = 807
				state = 85
			}
		}
		add_core_of = GER
		transfer_state_to = GER
	}
}

rudolf_hess_GER_YUG_states = {
	every_state = {
		limit = {
			OR = {
				state = 102
				state = 853
				state = 109
			}
		}
		transfer_state_to = GER
		GER = {
			release_on_controlled = CRO
			add_to_faction = CRO
		}
	}
	every_state = {
		# Can fix some problems i hope
		limit = {
			OR = {
				state = 103
				state = 163
				state = 852
			}
		}
		transfer_state_to = ITA
	}
}

rudolf_hess_ITA_YUG_states = {
	every_state = {
		limit = {
			OR = {
				state = 103
				state = 105
				state = 804
			}
		}
		transfer_state_to = ITA
	}
}

rudolf_hess_ITA_YUG_1_states = {
	every_state = {
		limit = {
			OR = {
				state = 103
				state = 804
			}
		}
		transfer_state_to = ITA
	}
}

rudolf_hess_ITA_ALB_YUG_states = {
	every_state = {
		limit = {
			OR = {
				state = 802
			}
		}
		transfer_state_to = ALB
	}
}

rudolf_hess_HUN_YUG_states = {
	every_state = {
		limit = {
			OR = {
				state = 45
				state = 764
			}
		}
		transfer_state_to = HUN
	}
}

rudolf_hess_BUL_YUG_states = {
	every_state = {
		limit = {
			OR = {
				state = 106
				state = 803
			}
		}
		transfer_state_to = BUL
	}
}

rudolf_hess_BUL_GRE_states = {
	every_state = {
		limit = {
			OR = {
				state = 731
				state = 184
			}
		}
		transfer_state_to = BUL
	}
}

rudolf_hess_ITA_GRE_states = {
	every_state = {
		limit = {
			OR = {
				state = 185
				state = 186
				state = 47
				state = 182
				state = 187
			}
		}
		transfer_state_to = ITA
	}
}

rudolf_hess_ITA_GRE_1_states = {
	ITA = {
		annex_country = {
			target = GRE
			transfer_troops = no
		}
	}
}

rudolf_hess_ITA_YUG_PUPPET_states = {
	YUG = {
		remove_ideas = anti_german_military
	}
	ITA = {
		puppet = YUG
	}
}

GER_spawn_penal_divisions_effect = {
	hidden_effect = {
		capital_scope = {
			create_unit = {
				division = "division_template = \"Strafbataillon\" start_experience_factor = 0.5 start_equipment_factor = 1.0"
				owner = ROOT
				count = 4
			}
		}
		set_country_flag = GER_penal_units_raised_flag
	}
}

GER_adolf_search_costs_idea_effect = {
	if = {
		limit = {
			has_idea = GER_search_costs_adolf
			NOT = {
				has_country_flag = GER_END_OF_SEARCH
			}
		}
		modify_timed_idea = {
			idea = GER_search_costs_adolf
			days = 30
		}
	}
	if = {
		limit = {
			NOT = {
				has_idea = GER_search_costs_adolf
			}
			NOT = {
				has_country_flag = GER_END_OF_SEARCH
			}
		}
		add_timed_idea = {
			idea = GER_search_costs_adolf
			days = 30
		}
	}
}

GER_adolf_personal_doctor_idea_effect = {
	if = {
		limit = {
			has_idea = GER_bad_state_adolf
		}
		modify_timed_idea = {
			idea = GER_bad_state_adolf
			days = 30
		}
	}
	if = {
		limit = {
			NOT = {
				has_idea = GER_bad_state_adolf
			}
		}
		add_timed_idea = {
			idea = GER_bad_state_adolf
			days = 30
		}
	}
}

GER_adolf_personal_doctor_effect = {
	if = {
		limit = {
			check_variable = {
				theodor_morell = 2
			}
		}
		subtract_from_variable = {
			Adolf_Health_Year_TIME = 30
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				theodor_morell = 3
			}
		}
		subtract_from_variable = {
			Adolf_Health_Year_TIME = 30
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				theodor_morell = 4
			}
		}
		subtract_from_variable = {
			Adolf_Health_Year_TIME = 90
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				theodor_morell = 5
			}
		}
		subtract_from_variable = {
			Adolf_Health_Year_TIME = 120
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
		add_country_leader_trait = GER_sick_leader
		set_country_leader_portrait = {
			ideology = fascism
			portrait = GFX_Portrait_Germany_Adolf_Hitler_health
		}
	}
	else_if = {
		limit = {
			check_variable = {
				theodor_morell = 6
			}
		}
		subtract_from_variable = {
			Adolf_Health_Year_TIME = 81
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				theodor_morell > 6
			}
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
}

GER_adolf_best_doctor_effect = {
	if = {
		limit = {
			check_variable = {
				best_doctors = 2
			}
		}
		subtract_from_variable = {
			Adolf_Health_Year_TIME = 30
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				best_doctors = 3
			}
		}
		subtract_from_variable = {
			Adolf_Health_Year_TIME = 30
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				best_doctors = 4
			}
		}
		subtract_from_variable = {
			Adolf_Health_Year_TIME = 120
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				best_doctors = 5
			}
		}
		set_country_flag = GER_END_OF_SEARCH
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				best_doctors > 5
			}
		}
		add_to_variable = {
			Adolf_Health_Year_TIME = 15
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
}

GER_adolf_rest_effect = {
	if = {
		limit = {
			check_variable = {
				adolf_hitler_rest = 2
			}
		}
		add_power_balance_value = {
			id = GER_power_balance
			value = 0.1
		}
		add_to_variable = {
			Adolf_Health_Year_TIME = 15
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				adolf_hitler_rest = 3
			}
		}
		add_power_balance_value = {
			id = GER_power_balance
			value = 0.1
		}
		add_to_variable = {
			Adolf_Health_Year_TIME = 15
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				adolf_hitler_rest = 4
			}
		}
		add_power_balance_value = {
			id = GER_power_balance
			value = 0.1
		}
		add_to_variable = {
			Adolf_Health_Year_TIME = 30
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				adolf_hitler_rest = 4
			}
		}
		add_power_balance_value = {
			id = GER_power_balance
			value = 0.1
		}
		add_to_variable = {
			Adolf_Health_Year_TIME = 60
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
	else_if = {
		limit = {
			check_variable = {
				adolf_hitler_rest > 5
			}
		}
		add_power_balance_value = {
			id = GER_power_balance
			value = 0.1
		}
		activate_mission = Adolf_Hitler_Yearly_Check_ups
	}
}

GER_end_of_goering = {
	if = {
		limit = {
			has_idea = goering
		}
		remove_ideas = goering
	}
	set_country_flag = GER_GOERING_RETIRED
}

GER_end_of_himmler = {
	if = {
		limit = {
			has_idea = heinrich_himmler
		}
		remove_ideas = heinrich_himmler
	}
	set_country_flag = GER_HIMMLER_RETIRED
}

GER_add_cost_of_forts = {
	set_country_flag = GER_working_on_atlantikwall
	if = {
		limit = {
			has_idea = Defense_Industry
		}
		effect_tooltip = {
			swap_ideas = {
				remove_idea = Defense_Industry
				add_idea = Defense_Industry_x
			}
		}
		hidden_effect = {
			remove_ideas = Defense_Industry
			add_timed_idea = {
				idea = Defense_Industry_x
				days = 30
			}
		}
	}
	if = {
		limit = {
			has_idea = Defense_Industry_2
		}
		effect_tooltip = {
			swap_ideas = {
				remove_idea = Defense_Industry_2
				add_idea = Defense_Industry_2_x
			}
		}
		hidden_effect = {
			remove_ideas = Defense_Industry_2
			add_timed_idea = {
				idea = Defense_Industry_2_x
				days = 30
			}
		}
	}
	if = {
		limit = {
			has_idea = Defense_Industry_3
		}
		effect_tooltip = {
			swap_ideas = {
				remove_idea = Defense_Industry_3
				add_idea = Defense_Industry_3_x
			}
		}
		hidden_effect = {
			remove_ideas = Defense_Industry_3
			add_timed_idea = {
				idea = Defense_Industry_3_x
				days = 30
			}
		}
	}
	if = {
		limit = {
			has_idea = Defense_Industry_4
		}
		effect_tooltip = {
			swap_ideas = {
				remove_idea = Defense_Industry_4
				add_idea = Defense_Industry_4_x
			}
		}
		hidden_effect = {
			remove_ideas = Defense_Industry_4
			add_timed_idea = {
				idea = Defense_Industry_4_x
				days = 30
			}
		}
	}
}

GER_supply_for_libya_effect = {
	GER = {
		#Should Reactive Mission so yeah.
		activate_mission = GER_Supply_for_Africa
	}
	ITA = {
		if = {
			limit = {
				is_in_faction_with = GER
			}
			every_controlled_state = {
				limit = {
					has_state_flag = LIBYA_LOGISTICS_STATE
					NOT = {
						has_global_flag = NO_MORE_SUPPLY_REQ_LIB
					}
					NOT = {
						OR = {
							has_dynamic_modifier = {
								modifier = NO_SUPPLY_STATE
							}
							has_dynamic_modifier = {
								modifier = LOW_SUPPLY_STATE
							}
							has_dynamic_modifier = {
								modifier = NORMAL_SUPPLY_STATE
							}
							has_dynamic_modifier = {
								modifier = EXTRA_SUPPLY_STATE
							}
						}
					}
				}
				add_dynamic_modifier = {
					modifier = LOW_SUPPLY_STATE
				}
			}
		}
	}
	LIB = {
		if = {
			limit = {
				is_puppet_of = ITA
				is_in_faction_with = GER
			}
			every_controlled_state = {
				limit = {
					has_state_flag = LIBYA_LOGISTICS_STATE
					NOT = {
						has_global_flag = NO_MORE_SUPPLY_REQ_LIB
					}
					NOT = {
						OR = {
							has_dynamic_modifier = {
								modifier = NO_SUPPLY_STATE
							}
							has_dynamic_modifier = {
								modifier = LOW_SUPPLY_STATE
							}
							has_dynamic_modifier = {
								modifier = NORMAL_SUPPLY_STATE
							}
							has_dynamic_modifier = {
								modifier = EXTRA_SUPPLY_STATE
							}
						}
					}
				}
				add_dynamic_modifier = {
					modifier = LOW_SUPPLY_STATE
				}
			}
		}
	}
}

GER_lower_supply_for_libya_effect = {
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = LOW_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = LOW_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = NO_SUPPLY_STATE
		}
	}
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = NORMAL_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = NORMAL_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = LOW_SUPPLY_STATE
		}
	}
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = EXTRA_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = EXTRA_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = NORMAL_SUPPLY_STATE
		}
	}
}

GER_low_supply_for_libya_effect = {
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = NO_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = NO_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = LOW_SUPPLY_STATE
		}
	}
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = LOW_SUPPLY_STATE
			}
		}
		# Still Low Supply Sorry
	}
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = NORMAL_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = NORMAL_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = LOW_SUPPLY_STATE
		}
	}
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = EXTRA_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = EXTRA_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = NORMAL_SUPPLY_STATE
		}
	}
}

GER_normal_supply_for_libya_effect = {
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = LOW_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = LOW_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = NORMAL_SUPPLY_STATE
		}
	}
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = NO_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = NO_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = LOW_SUPPLY_STATE
		}
	}
}

GER_extra_supply_for_libya_effect = {
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = NORMAL_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = NORMAL_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = EXTRA_SUPPLY_STATE
		}
	}
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = LOW_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = LOW_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = NORMAL_SUPPLY_STATE
		}
	}
	every_controlled_state = {
		limit = {
			has_dynamic_modifier = {
				modifier = NO_SUPPLY_STATE
			}
		}
		remove_dynamic_modifier = {
			modifier = NO_SUPPLY_STATE
		}
		add_dynamic_modifier = {
			modifier = NORMAL_SUPPLY_STATE
		}
	}
}

GER_add_cost_of_ship_search = {
	add_manpower = -1500
	add_equipment_to_stockpile = {
		type = convoy
		amount = -100
		producer = GER
	}
}

GER_add_refund_of_ship_search = {
	random_list = {
		25 = {
			add_manpower = 1500
			add_equipment_to_stockpile = {
				type = convoy
				amount = 100
				producer = GER
			}
		}
		25 = {
			add_manpower = 1250
			add_equipment_to_stockpile = {
				type = convoy
				amount = 75
				producer = GER
			}
		}
		25 = {
			add_manpower = 1000
			add_equipment_to_stockpile = {
				type = convoy
				amount = 50
				producer = GER
			}
		}
		25 = {
			add_manpower = 1000
			add_equipment_to_stockpile = {
				type = convoy
				amount = 50
				producer = GER
			}
		}
	}
}

GER_next_plans_effect = {
	if = {
		limit = {
			NOT = { has_global_flag = GER_Operation_Barbarossa_at_phase_2 }
			check_variable = {
				GER_success > 2
			}
			check_variable = {
				GER_success < 4
			}
		}
		# PHASE - 2
		set_global_flag = GER_Operation_Barbarossa_at_phase_2
		activate_mission = GER_conquer_Pskow
		activate_mission = GER_conquer_Misk_2
		activate_mission = GER_conquer_Orel
		activate_mission = GER_end_of_phase_two
	}
	else_if = {
		limit = {
			check_variable = {
				GER_failures > 0
			}
		}
		set_global_flag = GER_Operation_Barbarossa_Failed_phase_1
		GER = {
			remove_ideas = GER_barbarossa
			add_ideas = GER_barbarossa_war
			add_timed_idea = {
				idea = GER_War_Exhaustion
				days = 90
			}
		}
		GER = {
			country_event = {
				id = GER_health_adolf.2
				hours = 6
			}
		}
	}	
	if = {
		limit = {
			NOT = { has_global_flag = GER_Operation_Barbarossa_at_phase_3 }
			check_variable = {
				GER_success > 4
			}
			check_variable = {
				GER_success < 7
			}
		}
		# PHASE - 2
		activate_mission = GER_conquer_Leningrad
		activate_mission = GER_conquer_Moscow
		activate_mission = GER_conquer_Stalingrad
		activate_mission = GER_conquer_Sevastopol
		activate_mission = GER_end_of_phase_three
		set_global_flag = GER_Operation_Barbarossa_at_phase_3
		hidden_effect = {
			if = {
				limit = {
					has_active_mission = GER_conquer_Misk_2
					NOT = {
						has_active_mission = GER_conquer_Pskow
						has_active_mission = GER_conquer_Orel
					}
				}
				add_days_mission_timeout = {
					mission = GER_conquer_Misk_2
					days = 90
				}
			}
		}
	}
	else_if = {
		limit = {
			check_variable = {
				GER_failures > 1
			}
		}
		set_global_flag = GER_Operation_Barbarossa_Failed_phase_2
		GER = {
			remove_ideas = GER_barbarossa
			add_ideas = GER_barbarossa_war
			add_timed_idea = {
				idea = GER_War_Exhaustion
				days = 180
			}
		}
		GER = {
			country_event = {
				id = GER_health_adolf.2
				hours = 6
			}
		}
	}	
}	

GER_readd_barbarossa = {
	if = {
		limit = {
			has_war_with = SOV
			has_global_flag = GER_Leningrad_win
			has_global_flag = GER_Moscow_win
			has_global_flag = GER_Stalingrad_win
		}
		GER = {
			add_ideas = GER_barbarossa
		}
	}
	else = {
		set_global_flag = GER_Operation_Barbarossa_Failed_phase_3
		GER = {
			add_ideas = GER_barbarossa_war
			add_timed_idea = {
				idea = GER_War_Exhaustion
				days = 90
			}
		}
		GER = {
			country_event = {
				id = GER_health_adolf.2
				hours = 6
			}
		}
	}
}

GER_general_meeting = {
	clr_country_flag = GER_TALK_WITH_WEHRMACHT
	clr_country_flag = GER_TALK_WITH_LUFTWAFFE
	clr_country_flag = GER_TALK_WITH_KRIEGSMARINE
	clr_country_flag = GER_TALK_WITH_SS
	if = {
		limit = {
			check_variable = {
				wehrmacht_anger > 35
			}
			NOT = {
				has_country_flag = GER_KAISER_TAKE_OVER
			}
			NOT = {
				has_global_flag = GER_OPERATION_VALKYRIE
			}
		}
		random_list = {
			25 = {
				GER_bop_very_low_increase_effect = yes
			}
			35 = {
				set_global_flag = GER_OPERATION_VALKYRIE
				remove_ideas = heinrich_himmler
				remove_ideas = goering
				GER_heinrich_himmler = {
					set_character_flag = killed_by_bomb
					set_portraits = {
						army = {
							small = "GFX_portrait_Germany_heinrich_himmler_death_small"
						}
					}
				}
				GER_hermann_goring = {
					set_character_flag = killed_by_bomb
					set_portraits = {
						army = {
							small = "GFX_portrait_Germany_hermann_goring_death_small"
						}
					}
				}
				# Chief of Army --->
				if = {
					limit = {
						has_idea = ludwig_beck
					}
					remove_ideas = ludwig_beck
					GER_ludwig_beck = {
						set_character_flag = killed_by_bomb
						set_portraits = {
							army = {
								small = "GFX_portrait_Germany_ludwig_beck_death_small"
							}
						}
					}
				}
				else_if = {
					limit = {
						has_idea = wilhelm_keitel
					}
					remove_ideas = wilhelm_keitel
					GER_wilhelm_keitel = {
						set_character_flag = killed_by_bomb
						set_portraits = {
							army = {
								small = "GFX_portrait_Germany_wilhelm_keitel_death_small"
							}
						}
					}
				}
				else_if = {
					limit = {
						has_idea = franz_halder
					}
					remove_ideas = franz_halder
					GER_franz_halder = {
						set_character_flag = killed_by_bomb
						set_portraits = {
							army = {
								small = "GFX_portrait_Germany_franz_halder_death_small"
							}
						}
					}
				}
				else_if = {
					limit = {
						has_idea = walther_von_brauchitsch
					}
					remove_ideas = walther_von_brauchitsch
					GER_walther_von_brauchitsch = {
						set_character_flag = killed_by_bomb
						set_portraits = {
							army = {
								small = "GFX_portrait_Germany_walther_von_brauchitsch_death_small"
							}
						}
					}
				}
				else = {
					random_list = {
						25 = {
							remove_ideas = ludwig_beck
							GER_ludwig_beck = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_ludwig_beck_death_small"
									}
								}
							}
						}
						25 = {
							remove_ideas = wilhelm_keitel
							GER_wilhelm_keitel = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_wilhelm_keitel_death_small"
									}
								}
							}
						}
						25 = {
							remove_ideas = franz_halder
							GER_franz_halder = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_franz_halder_death_small"
									}
								}
							}
						}
						25 = {
							remove_ideas = walther_von_brauchitsch
							GER_walther_von_brauchitsch = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_walther_von_brauchitsch_death_small"
									}
								}
							}
						}
					}
				}
				# Chief of Air --->
				if = {
					limit = {
						has_idea = ritter_von_greim
					}
					remove_ideas = ritter_von_greim
					GER_ritter_von_greim = {
						set_character_flag = killed_by_bomb
						set_portraits = {
							army = {
								small = "GFX_portrait_Germany_ritter_von_greim_death_small"
							}
						}
					}
				}
				else_if = {
					limit = {
						has_idea = albert_kesselring
					}
					remove_ideas = albert_kesselring
					GER_albert_kesselring = {
						set_character_flag = killed_by_bomb
						set_portraits = {
							army = {
								small = "GFX_portrait_Germany_albert_kesselring_death_small"
							}
						}
					}
				}
				else = {
					random_list = {
						50 = {
							remove_ideas = ritter_von_greim
							GER_ritter_von_greim = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_ritter_von_greim_death_small"
									}
								}
							}
						}
						50 = {
							remove_ideas = albert_kesselring
							GER_albert_kesselring = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_albert_kesselring_death_small"
									}
								}
							}
						}
					}
				}
				# Chief of Navy --->					
				if = {
					limit = {
						has_idea = raeder
					}
					remove_ideas = raeder
					GER_erich_raeder = {
						set_character_flag = killed_by_bomb
						set_portraits = {
							army = {
								small = "GFX_portrait_Germany_erich_raeder_death_small"
							}
						}
						retire = yes
					}
				}
				else_if = {
					limit = {
						has_idea = donitz
					}
					remove_ideas = donitz
					GER_karl_donitz = {
						set_character_flag = killed_by_bomb
						set_portraits = {
							army = {
								small = "GFX_portrait_Germany_karl_donitz_death_small"
							}
						}
						retire = yes
					}
				}
				else = {
					random_list = {
						50 = {
							remove_ideas = raeder
							GER_erich_raeder = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_erich_raeder_death_small"
									}
								}
								retire = yes
							}
						}
						50 = {
							remove_ideas = donitz
							GER_karl_donitz = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_karl_donitz_death_small"
									}
								}
								retire = yes
							}
						}
					}
				}
				#
				add_stability = -0.25
				add_war_support = -0.2
				hidden_effect = {
					kill_country_leader = yes
					GER_valkyrie_leader = {
						add_country_leader_role = {
							promote_leader = yes
							country_leader = {
								ideology = fascism_ideology
								expire = "1965.1.1.1"
								traits = {
								}
							}
						}
					}
					set_global_flag = GER_DEFEAT_TREE
					remove_dynamic_modifier = {
						modifier = SS_forces_dynamic_modifier
					}
					remove_dynamic_modifier = {
						modifier = SS_forces_1_dynamic_modifier
					}
					set_global_flag = Adolf_killed
					remove_power_balance = {
						id = GER_power_balance
					}
					if = {
						limit = {
							has_completed_focus = GER_the_Supreme_Commander
						}
						retire_character = GER_SUPREM_adolf_hitler
					}
					uncomplete_national_focus = {
						focus = GER_Fuhrer
						uncomplete_children = no
						refund_political_power = no
					}
					complete_national_focus = GER_hitler_is_gone
					set_country_flag = GER_SIDE_LEADERS
					complete_national_focus = GER_valkyrie_leader
					mark_focus_tree_layout_dirty = yes
				}
			}
			20 = {
				set_global_flag = GER_OPERATION_VALKYRIE
				hidden_effect = {
					random_list = {
						25 = {
							random_list = {
								50 = {
									remove_ideas = heinrich_himmler
									GER_heinrich_himmler = {
										set_character_flag = killed_by_bomb
										set_portraits = {
											army = {
												small = "GFX_portrait_Germany_heinrich_himmler_death_small"
											}
										}
									}
								}
								50 = {
									remove_ideas = goering
									GER_hermann_goring = {
										set_character_flag = killed_by_bomb
										set_portraits = {
											army = {
												small = "GFX_portrait_Germany_hermann_goring_death_small"
											}
										}
									}
								}
							}
						}
						25 = {
							if = {
								limit = {
									has_idea = ludwig_beck
								}
								remove_ideas = ludwig_beck
								GER_ludwig_beck = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_ludwig_beck_death_small"
										}
									}
								}
							}
							else_if = {
								limit = {
									has_idea = wilhelm_keitel
								}
								remove_ideas = wilhelm_keitel
								GER_wilhelm_keitel = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_wilhelm_keitel_death_small"
										}
									}
								}
							}
							else_if = {
								limit = {
									has_idea = franz_halder
								}
								remove_ideas = franz_halder
								GER_franz_halder = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_franz_halder_death_small"
										}
									}
								}
							}
							else_if = {
								limit = {
									has_idea = walther_von_brauchitsch
								}
								remove_ideas = walther_von_brauchitsch
								GER_walther_von_brauchitsch = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_walther_von_brauchitsch_death_small"
										}
									}
								}
							}
							else = {
								random_list = {
									25 = {
										remove_ideas = ludwig_beck
										GER_ludwig_beck = {
											set_character_flag = killed_by_bomb
											set_portraits = {
												army = {
													small = "GFX_portrait_Germany_ludwig_beck_death_small"
												}
											}
										}
									}
									25 = {
										remove_ideas = wilhelm_keitel
										GER_wilhelm_keitel = {
											set_character_flag = killed_by_bomb
											set_portraits = {
												army = {
													small = "GFX_portrait_Germany_wilhelm_keitel_death_small"
												}
											}
										}
									}
									25 = {
										remove_ideas = franz_halder
										GER_franz_halder = {
											set_character_flag = killed_by_bomb
											set_portraits = {
												army = {
													small = "GFX_portrait_Germany_franz_halder_death_small"
												}
											}
										}
									}
									25 = {
										remove_ideas = walther_von_brauchitsch
										GER_walther_von_brauchitsch = {
											set_character_flag = killed_by_bomb
											set_portraits = {
												army = {
													small = "GFX_portrait_Germany_walther_von_brauchitsch_death_small"
												}
											}
										}
									}
								}
							}
						}
						25 = {
							if = {
								limit = {
									has_idea = ritter_von_greim
								}
								remove_ideas = ritter_von_greim
								GER_ritter_von_greim = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_ritter_von_greim_death_small"
										}
									}
								}
							}
							else_if = {
								limit = {
									has_idea = albert_kesselring
								}
								remove_ideas = albert_kesselring
								GER_albert_kesselring = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_albert_kesselring_death_small"
										}
									}
								}
							}
							else = {
								random_list = {
									# TODO
									50 = {
										remove_ideas = ritter_von_greim
										GER_ritter_von_greim = {
											set_character_flag = killed_by_bomb
											set_portraits = {
												army = {
													small = "GFX_portrait_Germany_ritter_von_greim_death_small"
												}
											}
										}
									}
									50 = {
										remove_ideas = albert_kesselring
										GER_albert_kesselring = {
											set_character_flag = killed_by_bomb
											set_portraits = {
												army = {
													small = "GFX_portrait_Germany_albert_kesselring_death_small"
												}
											}
										}
									}
								}
							}
						}
						25 = {
							if = {
								limit = {
									has_idea = raeder
								}
								remove_ideas = raeder
								GER_erich_raeder = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_erich_raeder_death_small"
										}
									}
									retire = yes
								}
							}
							else_if = {
								limit = {
									has_idea = donitz
								}
								remove_ideas = donitz
								GER_karl_donitz = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_karl_donitz_death_small"
										}
									}
									retire = yes
								}
							}
							else = {
								random_list = {
									50 = {
										remove_ideas = raeder
										GER_erich_raeder = {
											set_character_flag = killed_by_bomb
											set_portraits = {
												army = {
													small = "GFX_portrait_Germany_erich_raeder_death_small"
												}
											}
											retire = yes
										}
									}
									50 = {
										remove_ideas = donitz
										GER_karl_donitz = {
											set_character_flag = killed_by_bomb
											set_portraits = {
												army = {
													small = "GFX_portrait_Germany_karl_donitz_death_small"
												}
											}
											retire = yes
										}
									}
								}
							}
						}
					}
					add_stability = -0.2
					add_war_support = -0.1
					activate_mission = GER_eliminate_traitor
					start_civil_war = {
						ideology = neutrality
						size = 0.1
						set_country_flag = GER_CIVILWAR_VALKRIE_COUNTRY
					}
				}
			}
			20 = {
				set_global_flag = GER_OPERATION_VALKYRIE
				hidden_effect = {
					# Death of Alt. Leader
					random_list = {
						50 = {
							remove_ideas = heinrich_himmler
							GER_heinrich_himmler = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_heinrich_himmler_death_small"
									}
								}
							}
						}
						50 = {
							remove_ideas = goering
							GER_hermann_goring = {
								set_character_flag = killed_by_bomb
								set_portraits = {
									army = {
										small = "GFX_portrait_Germany_hermann_goring_death_small"
									}
								}
							}
						}
					}
					# Chief of Army --->
					if = {
						limit = {
							has_idea = ludwig_beck
						}
						remove_ideas = ludwig_beck
						GER_ludwig_beck = {
							set_character_flag = killed_by_bomb
							set_portraits = {
								army = {
									small = "GFX_portrait_Germany_ludwig_beck_death_small"
								}
							}
						}
					}
					else_if = {
						limit = {
							has_idea = wilhelm_keitel
						}
						remove_ideas = wilhelm_keitel
						GER_wilhelm_keitel = {
							set_character_flag = killed_by_bomb
							set_portraits = {
								army = {
									small = "GFX_portrait_Germany_wilhelm_keitel_death_small"
								}
							}
						}
					}
					else_if = {
						limit = {
							has_idea = franz_halder
						}
						remove_ideas = franz_halder
						GER_franz_halder = {
							set_character_flag = killed_by_bomb
							set_portraits = {
								army = {
									small = "GFX_portrait_Germany_franz_halder_death_small"
								}
							}
						}
					}
					else_if = {
						limit = {
							has_idea = walther_von_brauchitsch
						}
						remove_ideas = walther_von_brauchitsch
						GER_walther_von_brauchitsch = {
							set_character_flag = killed_by_bomb
							set_portraits = {
								army = {
									small = "GFX_portrait_Germany_walther_von_brauchitsch_death_small"
								}
							}
						}
					}
					else = {
						random_list = {
							25 = {
								remove_ideas = ludwig_beck
								GER_ludwig_beck = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_ludwig_beck_death_small"
										}
									}
								}
							}
							25 = {
								remove_ideas = wilhelm_keitel
								GER_wilhelm_keitel = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_wilhelm_keitel_death_small"
										}
									}
								}
							}
							25 = {
								remove_ideas = franz_halder
								GER_franz_halder = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_franz_halder_death_small"
										}
									}
								}
							}
							25 = {
								remove_ideas = walther_von_brauchitsch
								GER_walther_von_brauchitsch = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_walther_von_brauchitsch_death_small"
										}
									}
								}
							}
						}
					}
					# Chief of Air --->
					if = {
						limit = {
							has_idea = ritter_von_greim
						}
						remove_ideas = ritter_von_greim
						GER_ritter_von_greim = {
							set_character_flag = killed_by_bomb
							set_portraits = {
								army = {
									small = "GFX_portrait_Germany_ritter_von_greim_death_small"
								}
							}
						}
					}
					else_if = {
						limit = {
							has_idea = albert_kesselring
						}
						remove_ideas = albert_kesselring
						GER_albert_kesselring = {
							set_character_flag = killed_by_bomb
							set_portraits = {
								army = {
									small = "GFX_portrait_Germany_albert_kesselring_death_small"
								}
							}
						}
					}
					else = {
						random_list = {
							# TODO
							50 = {
								remove_ideas = ritter_von_greim
								GER_ritter_von_greim = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_ritter_von_greim_death_small"
										}
									}
								}
							}
							50 = {
								remove_ideas = albert_kesselring
								GER_albert_kesselring = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_albert_kesselring_death_small"
										}
									}
								}
							}
						}
					}
					# Chief of Navy --->					
					if = {
						limit = {
							has_idea = raeder
						}
						remove_ideas = raeder
						GER_erich_raeder = {
							set_character_flag = killed_by_bomb
							set_portraits = {
								army = {
									small = "GFX_portrait_Germany_erich_raeder_death_small"
								}
							}
							retire = yes
						}
					}
					else_if = {
						limit = {
							has_idea = donitz
						}
						remove_ideas = donitz
						GER_karl_donitz = {
							set_character_flag = killed_by_bomb
							set_portraits = {
								army = {
									small = "GFX_portrait_Germany_karl_donitz_death_small"
								}
							}
							retire = yes
						}
					}
					else = {
						random_list = {
							50 = {
								remove_ideas = raeder
								GER_erich_raeder = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_erich_raeder_death_small"
										}
									}
									retire = yes
								}
							}
							50 = {
								remove_ideas = donitz
								GER_karl_donitz = {
									set_character_flag = killed_by_bomb
									set_portraits = {
										army = {
											small = "GFX_portrait_Germany_karl_donitz_death_small"
										}
									}
									retire = yes
								}
							}
						}
					}
					#
					add_stability = -0.25
					add_war_support = -0.2
					activate_mission = GER_eliminate_traitor
					country_event = {
						id = GER_new_leader.3
						hours = 5
					}
				}
			}
		}
	}
	else = {
		GER_bop_very_low_increase_effect = yes
	}
}

GER_defeat_effect = {
	if = {
		limit = {
			NOT = {
				has_country_flag = GER_SIDE_WITH_COMITERN
			}
		}
		ENG = {
			# Split Germany to Two
			start_peace_conference = {
				tag = GER
				score_factor = 0
				loser_scope = GER
				winner_scope = ALL
				loser_scope = LIMITED
			}
			GER = { drop_cosmetic_tag = yes }
			puppet = GER
			set_autonomy = {
				target = GER
				autonomy_state = autonomy_supervised_state
				end_wars = no
				end_civil_wars = no
			}
			GER = { set_cosmetic_tag = WGR }
		}
		DDR = {
			add_state_core = 538
			add_state_core = 65
			add_state_core = 64
			add_state_core = 61
			add_state_core = 62
			add_state_core = 63
			add_state_core = 68
			add_state_core = 66
			transfer_state = 538
			transfer_state = 65
			transfer_state = 64
			transfer_state = 61
			transfer_state = 62
			transfer_state = 63
			transfer_state = 68
			transfer_state = 66
		}
		SOV = {
			puppet = DDR
		}
		DDR = { set_cosmetic_tag = DDR }
		DDR = {
			load_focus_tree = { tree = german_better keep_completed = yes }
			set_country_flag = GER_SIDE_WITH_COMITERN
		}
	}
	if = {
		limit = {
			has_country_flag = GER_SIDE_WITH_COMITERN
		}
		SOV = {
			# Split Germany to Two
			start_peace_conference = {
				tag = GER
				score_factor = 0
				loser_scope = GER
				winner_scope = ALL
				loser_scope = LIMITED
			}
			GER = { drop_cosmetic_tag = yes }
			puppet = GER
		}
		GER = { set_cosmetic_tag = DDR }
		WGR = {
			add_state_core = 909
			add_state_core = 58
			add_state_core = 59
			add_state_core = 56
			add_state_core = 57
			add_state_core = 51
			add_state_core = 42
			add_state_core = 50
			add_state_core = 55
			add_state_core = 54
			add_state_core = 53
			add_state_core = 52
			add_state_core = 935
			transfer_state = 909
			transfer_state = 58
			transfer_state = 59
			transfer_state = 56
			transfer_state = 57
			transfer_state = 51
			transfer_state = 42
			transfer_state = 50
			transfer_state = 55
			transfer_state = 54
			transfer_state = 53
			transfer_state = 52
			transfer_state = 935
		}
		ENG = {
			puppet = WGR
			set_autonomy = {
				target = WGR
				autonomy_state = autonomy_supervised_state
			}
		}
		WGR = { set_cosmetic_tag = WGR }
		WGR = {
			load_focus_tree = { tree = german_better keep_completed = yes }
			set_country_flag = GER_SIDE_WITH_ALLIED
		}
	}
	if = {
		limit = {
			AND = {
				69 = { is_owned_by = GER }
				9 = { is_owned_by = GER }
				75 = { is_owned_by = GER }
				74 = { is_owned_by = GER }
			}
		}
		GER = {
			release_on_controlled = CZE
		}
	}
	if = {
		limit = {
			GER = {
				SLO = {
					is_puppet_of = GER
				}
			}
		}
		GER = {
			set_autonomy = {
				target = SLO
				autonomy_state = autonomy_free
				end_wars = no
				end_civil_wars = no
			}
			SLO = {
				set_politics = {
					ruling_party = democratic
				}
			}
		}
	}
	if = {
		limit = {
			848 = { is_owned_by = GER }
			153 = { is_owned_by = GER }
			152 = { is_owned_by = GER }
			4 = { is_owned_by = GER }
		}
		GER = {
			release_on_controlled = AUS
			AUS = {
				set_politics = {
					ruling_party = democratic
				}
			}
		}
	}
	if = {
		limit = {
			POL = { exists = yes }
			5 = {
				is_owned_by = GER
			}
		}
		5 = {
			transfer_state_to = POL
		}
	}
	if = {
		limit = {
			POL = { exists = yes }
			OR = {
				63 = { is_owned_by = GER }
				68 = { is_owned_by = GER }
				66 = { is_owned_by = GER }
				67 = { is_owned_by = GER }
			}
		}
		every_state = {
			limit = {
				OR = {
					state = 63
					state = 68
					state = 66
					state = 67
				}
				is_owned_by = GER
			}
			transfer_state_to = POL
		}
	}
	if = {
		limit = {
			763 = {
				is_owned_by = GER
			}
		}
		763 = {
			transfer_state_to = SOV
		}
	}
	if = {
		limit = {
			188 = {
				is_owned_by = GER
			}
		}
		if = {
			limit = {
				LIT = {
					is_puppet_of = SOV
				}
			}
			188 = {
				transfer_state_to = LIT
			}
		}
		else = {
			188 = {
				transfer_state_to = SOV
			}
		}
	}
}

GER_abwehr_rd = {
	if = {
		limit = {
			has_dlc = "La Resistance"
		}
		if = {
			limit = { GER = { has_idea = abwehr_agent }  }
			GER = {
				swap_ideas = {
					remove_idea = abwehr_agent
					add_idea = abwehr_agent_r
				}
			}
		}
		if = {
			limit = { GER = { has_idea = abwehr_agent_v }  }
			GER = {
				swap_ideas = {
					remove_idea = abwehr_agent_v
					add_idea = abwehr_agent_v_r
				}
			}
		}
	}
	else = {
		if = {
			limit = {
				GER = { 
					has_idea = abwehr_agent_non_dlc
				}
			}
			GER = {
				swap_ideas = {
					remove_idea = abwehr_agent_non_dlc
					add_idea = abwehr_agent_non_dlc_r
				}
			}
		}
		if = {
			limit = { 
				GER = { 
					has_idea = abwehr_agent_non_dlc_v 
				}  
			}
			GER = {
				swap_ideas = {
					remove_idea = abwehr_agent_non_dlc_v
					add_idea = abwehr_agent_non_dlc_v_r
				}
			}
		}
	}
}
